<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
          Elastic 6.3 에서 상용 라이센스 활성 - Jongmin&#39;s blog
        
    </title>

    <link rel="canonical" href="http://kimjmin.net/2018/08/2018-08-install-security-over-es63/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link rel="stylesheet" href="/css/kimjmin.css">
    
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="http://cdn.staticfile.org/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Jongmin&#39;s Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    
<!-- Image to hack wechat -->
<!-- <img src="http://kimjmin.net/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="{{ site.baseurl }}/{% if page.header-img %}{{ page.header-img }}{% else %}{{ site.header-img }}{% endif %}" width="0" height="0"> -->

<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('bg-linux-prompt.jpeg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                          <a class="tag" href="/tags/#Elasticsearch" title="Elasticsearch">Elasticsearch</a>
                        
                          <a class="tag" href="/tags/#Elastic" title="Elastic">Elastic</a>
                        
                          <a class="tag" href="/tags/#Elastic Cluster Settings" title="Elastic Cluster Settings">Elastic Cluster Settings</a>
                        
                    </div>
                    <h1>Elastic 6.3 에서 상용 라이센스 활성</h1>
                    <h2 class="subheading">Elastic Satck 6.3 부터 상용 기능이 기본 내장으로 변경됨에 따른 새로운 설정법에 대해 설명합니다.</h2>
                    <span class="meta">
                        Posted by Jongmin Kim (김종민) on
                        2018-08-11
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">
                
                <div>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- kimjmin.net -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-9760232529092117"
       data-ad-slot="1811620965"
       data-ad-format="auto"></ins>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>
                
                <p>Elastic Satck 6.3 부터는 기존의 X-Pack 상용 기능이 별도 설치가 아닌 기본 내장으로 변경되었습니다. 이에 따른 새로운 설정법에 대해 설명합니다. Elastic Cluster 생성과 기본 설정에 대한 부분은 이전의 Elastic Cluster 구성 시리즈를 참고하세요.</p>
<blockquote>
<p><a href="/2018/01/2018-01-build-es-cluster-1">1. 서버 생성 및 Elasticsearch RPM 설치</a><br><a href="/2018/01/2018-01-build-es-cluster-2">2. 메모리, 네트워크 설정 및 플러그인 설치</a><br><a href="/2018/01/2018-01-build-es-cluster-3">3. 클러스터 구성 및 마스터, 데이터 노드 설정</a><br><a href="/2018/01/2018-01-build-es-cluster-4">4. Kibana 설치 및 X-Pack Monitoring 확인</a><br><a href="/2018/01/2018-01-build-es-cluster-5">5. NFS 구성 및 elasticsearch 추가 설정</a><br><a href="/2018/01/2018-01-build-es-cluster-6">6. X-Pack Security를 이용한 SSL 및 TLS 설정</a><br><a href="/2018/01/2018-01-build-es-cluster-7">7. X-Pack License 적용 및 사용자 생성</a><br><a href="/2018/01/2018-01-build-es-cluster-8">8. Logstash 설치 및 Elasticsearch 기본 템플릿 설정</a></p>
</blockquote>
<p>Elastic Stack 6.3 버전부터 큰 변화가 있었습니다. 기존에 별도 플러그인으로 제공하던 기능들을 기본 배포 패키지에 포함시키게 되었습니다. 이에 대한 내용은 Elastic 공식 페이지의 아래 블로그 포스트를 참고하세요.</p>
<p><a href="https://www.elastic.co/kr/blog/doubling-down-on-open" target="_blank" rel="noopener">https://www.elastic.co/kr/blog/doubling-down-on-open</a></p>
<p>6.3 버전부터는 x-pack 플러그인 설치팩을 제공하지 않습니다. 2018년 8월 부터는 X-Pack 이라는 브랜드도 버리고 Elastic 확장 기능 (Elastic Feature) 라고만 명명하고 있습니다. 6.2 이전 버전에서는 <code>bin/elasticsearch-plugin install x-pack</code> 명령으로 계속 설치가 가능합니다. 6.3 버전 부터는 <a href="https://www.elastic.co/kr/downloads" target="_blank" rel="noopener">다운로드 페이지</a> 에서 아래와 같이 확장 기능이 포함된 배포판을 내려받을 수 있습니다.</p>
<p><img src="download.png" alt=""></p>
<p>라이센스 정책이 Elastic License로 바뀐 것을 볼 수 있습니다. 예전처럼 Apache 2.0 라이센스 버전을 내려받으려면 <a href="https://www.elastic.co/downloads/elasticsearch-oss" target="_blank" rel="noopener">https://www.elastic.co/downloads/elasticsearch-oss</a> 처럼 각 제품의 -oss 페이지에서 내려받을 수 있습니다.</p>
<p><img src="download-oss.png" alt=""></p>
<h3 id="cluster-구성"><a href="#cluster-구성" class="headerlink" title="cluster 구성"></a>cluster 구성</h3><p>3개의 서버에서 마스터, 데이터 노드등의 설정은 따로 구분하지 않고 3개의 노드로 클러스터를 구성 해 보겠습니다. 구성할 클러스터 정보와 각 서버들의 IP 주소는 아래와 같습니다. 그리고 각 서버에서 elasticsearch 노드들은 <code>elastic</code> 리눅스 계정으로 실행하겠습니다.</p>
<ul>
<li>클러스터명 : <strong>es-cluster</strong></li>
<li>노드명: <strong>es-node1, es-node2, es-node3</strong></li>
<li>각 서버 IP 주소 : <strong>179.34.27.193, 179.34.16.96, 179.34.22.211</strong></li>
</ul>
<p>디스커버리 정보를 IP 주소로 적어도 되지만 좀 더 편하게 하기 위해 <code>/ect/hosts</code> 파일에 아래 정보를 추가하겠습니다.<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">179.34.27.193   es-node1</span><br><span class="line">179.34.16.96    es-node2</span><br><span class="line">179.34.22.211   es-node3</span><br></pre></td></tr></table></figure></p>
<p>이제 각 서버별로 <code>elasticsearch.yml</code> 파일에 아래 설정들을 추가합니다.<br><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">cluster.name:</span> <span class="string">es-cluster</span></span><br><span class="line"><span class="string">node.name:</span> <span class="string">$&#123;HOSTNAME&#125;</span></span><br><span class="line"><span class="string">network.host:</span> <span class="string">_site_</span></span><br><span class="line"><span class="string">bootstrap.memory_lock:</span> <span class="literal">true</span></span><br><span class="line"><span class="string">discovery.zen.ping.unicast.hosts:</span> <span class="string">["es-node1","es-node2","es-node3"]</span></span><br></pre></td></tr></table></figure></p>
<p><code>network.host</code> 설정을 실제 IP 주소로 주면 (<code>_site_</code>로 하면 자동으로 잡습니다) 부트스트랩 체크를 해서 바로 실행이 되지 않을 수 있습니다. 보통은<br><code>/etc/security/limits.conf</code><br>파일에<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">elastic soft memlock unlimited</span><br><span class="line">elastic hard memlock unlimited</span><br><span class="line">elastic - nofile  65536</span><br></pre></td></tr></table></figure></p>
<p>내용을 추가 해 주면 실행 됩니다. elastic 은 실행 할 리눅스 계정입니다. 정확한 것은 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/bootstrap-checks.html" target="_blank" rel="noopener">Bootstrap Checks</a> 문서를 참고하세요.</p>
<p>이제 es-node1 과 같은 서버에서 kibana를 실행하겠습니다. <code>kibana.yml</code> 파일에 다음 설정을 추가합니다.<br><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">server.host:</span> <span class="string">"es-node1"</span></span><br><span class="line"><span class="string">elasticsearch.url:</span> <span class="string">"http://es-node1:9200"</span></span><br></pre></td></tr></table></figure></p>
<p>이제 kibana 를 실행시켜 보겠습니다. 6.3 버전 부터는 이전 버전과 달리 Basic 기능(APM, 모니터링 등) 들이 이미 설치 된 채로 구동되는 것을 확인할 수 있습니다.</p>
<p><img src="kibana-init.png" alt=""></p>
<h3 id="모니터링-설정"><a href="#모니터링-설정" class="headerlink" title="모니터링 설정"></a>모니터링 설정</h3><p>모니터링 기능은 Basic 라이센스 이기 때문에 미리 설치는 되어 있으나, 모니터링 데이터를 수집하고 있지는 않습니다. Kibana 의 모니터링 메뉴에 가서 Turn on monitoring 버튼을 클릭하기만 하면 모니터링 기능이 활성화 됩니다.</p>
<p><img src="monitoring.png" alt=""></p>
<p>모니터링 기능을 활성화하고 나면 아래와 같이 모니터링 정보가 나타납니다.</p>
<p><img src="monitoring-enabled.png" alt=""></p>
<h3 id="Gold-Platinum-기능-활성"><a href="#Gold-Platinum-기능-활성" class="headerlink" title="Gold / Platinum 기능 활성"></a>Gold / Platinum 기능 활성</h3><p>Security, Graph, Machine Learning 등의 기능은 Gold, Platinum 등에서 사용 가능한 유료 기능입니다. 이 기능을 활성화 하려면 Kibana의<br>Management &gt; License Management 메뉴에 가서 </p>
<ol>
<li><code>Start a 30-day trial</code> 을 선택하고 30일 간 Platimun 기능을 무료로 사용 하던가</li>
<li><code>Update your license</code> 를 선택하고 구매한 Gold / Platinum 라이센스를 업로드 해서 활성화 할 수 있습니다.</li>
</ol>
<p><img src="license.png" alt=""> <img src="license-upload.png" alt=""></p>
<p>하지만 라이센스를 업로드 하려고 하면 아래와 같이 Security 설정에서 TLS를 적용해야 한다고 나옵니다.</p>
<p><img src="license-upload-no.png" alt=""></p>
<p>우선은 30일 트라이얼로 전환한 뒤 Security 와 TLS를 활성화 하고 다시 라이센스를 적용해야 할 것 같습니다. <code>Start a 30-day trial</code> 을 선택하여 트라이얼을 활성화 시킵니다.</p>
<p><img src="trial.png" alt=""></p>
<p>Kibana 화면을 새로고침 해 보면 Graph, Machine Learning 등의 플래티넘 기능들이 활성화 된 것을 확인할 수 있습니다.</p>
<p><img src="trial-enabled.png" alt=""></p>
<h3 id="Security-설정"><a href="#Security-설정" class="headerlink" title="Security 설정"></a>Security 설정</h3><p>하지만 Security 기능은 처음부터 활성화 되어 있지 않습니다. 6.2 버전 까지는 x-pack 을 확장팩으로 설치하게 되면 기본적으로 모든 x-pack 기능들의 설정이 enabled 되어 실행이 되었습니다. 하지만 Security의 경우는 6.3 부터는 disabled 가 디폴트로 되어 6.2 이전 버전에서 6.3 이후 버전으로 업그레이드 하는 경우 좀 복잡할 수 있습니다.<br>Security 기능을 활성하려면 elasticsearch.yml 파일에 설정을 추가 해 줘야 합니다. 이 설정이 다르면 노드들이 바인딩 되지 않기 때문에 노드별로 할 수가 없어서 어쩔 수 없이 full cluster restart 를 해야 합니다.</p>
<p>elasticsearch.yml 파일에 아래 설정을 추가한 뒤 모든 노드를 재시작합니다.<br><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">xpack.security.enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></p>
<p>위 설정은 6.3 기준입니다. x-pack 이라는 브랜딩을 앞으로 사용하지 않기 때문에 <span style="color:red"><strong>6.x 이후 어느 시점에서는 위 설정 방법도 바뀔 수 있습니다.</strong></span></p>
<p>Security를 활성화 한 뒤에는 자동으로 생성되는 기본 계정들의 패스워드를 설정 해 줘야 합니다. 노드가 실행되고 있는 상태에서 새로 콘솔을 열고 elasticsearch 홈 디렉토리 아래 bin 디렉토리 아래에 있는 elasticsearch-setup-passwords 명령을 실행하면 기본 계정들의 패스워드를 설정할 수 있습니다. 실행 가능한 옵션은 아래 두가지가 있습니다.</p>
<ul>
<li><strong>auto</strong> : 임의의 패스워드를 설정합니다. 패스워드들은 이 명령 실행 후 콘솔에 딱 한번 나타나기 때문에 다른곳에 잘 적어 보관해야 합니다.</li>
<li><strong>interactive</strong> : 각 계정별로 패스워드를 직접 설정합니다.</li>
</ul>
<p>저희는 interactive 로 해 보겠습니다.<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[]$ bin/elasticsearch-setup-passwords interactive</span><br><span class="line">Initiating the setup of passwords for reserved users elastic,kibana,logstash_system,beats_system.</span><br><span class="line">You will be prompted to enter passwords as the process progresses.</span><br><span class="line">Please confirm that you would like to continue [y/N]y</span><br><span class="line"></span><br><span class="line">Enter password for [elastic]:</span><br><span class="line">Reenter password for [elastic]:</span><br><span class="line">Enter password for [kibana]:</span><br><span class="line">Reenter password for [kibana]:</span><br><span class="line">Enter password for [logstash_system]:</span><br><span class="line">Reenter password for [logstash_system]:</span><br><span class="line">Enter password for [beats_system]:</span><br><span class="line">Reenter password for [beats_system]:</span><br><span class="line">Changed password for user [kibana]</span><br><span class="line">Changed password for user [logstash_system]</span><br><span class="line">Changed password for user [beats_system]</span><br><span class="line">Changed password for user [elastic]</span><br><span class="line">[]$</span><br></pre></td></tr></table></figure></p>
<p>위 명령에는 보이지 않았지만 <code>elastic</code>,<code>kibana</code>,<code>logstash_system</code>,<code>beats_system</code> 각 계정에 대해 설정할 패스워드를 2번씩 쳐 넣습니다. 저는 모든 계정의 패스워드를 <code>changeme</code> 로 했습니다. 패스워드를 넣지 않고 curl 명령을 한번 날려보고, 다시 -u elastic:changeme 를 추가하고 날려봐서 제대로 설정이 되었는지 확인합니다.<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[]$ curl es-node1:9200</span><br><span class="line">&#123;&quot;error&quot;:&#123;&quot;root_cause&quot;:[&#123;&quot;type&quot;:&quot;security_exception&quot;,&quot;reason&quot;:&quot;missing authentication token for REST request [/]&quot;,&quot;header&quot;:&#123;&quot;WWW-Authenticate&quot;:&quot;Basic realm=\&quot;security\&quot; charset=\&quot;UTF-8\&quot;&quot;&#125;&#125;],&quot;type&quot;:&quot;security_exception&quot;,&quot;reason&quot;:&quot;missing authentication token for REST request [/]&quot;,&quot;header&quot;:&#123;&quot;WWW-Authenticate&quot;:&quot;Basic realm=\&quot;security\&quot; charset=\&quot;UTF-8\&quot;&quot;&#125;&#125;,&quot;status&quot;:401&#125;</span><br><span class="line"></span><br><span class="line">[]$ curl es-node1:9200 -u elastic:changeme</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot; : &quot;kr-demo-service&quot;,</span><br><span class="line">  &quot;cluster_name&quot; : &quot;es-cluster&quot;,</span><br><span class="line">  &quot;cluster_uuid&quot; : &quot;ZJ1eRGTRSzeiUzT0MTY--Q&quot;,</span><br><span class="line">  &quot;version&quot; : &#123;</span><br><span class="line">    &quot;number&quot; : &quot;6.3.2&quot;,</span><br><span class="line">    &quot;build_flavor&quot; : &quot;default&quot;,</span><br><span class="line">    &quot;build_type&quot; : &quot;tar&quot;,</span><br><span class="line">    &quot;build_hash&quot; : &quot;053779d&quot;,</span><br><span class="line">    &quot;build_date&quot; : &quot;2018-07-20T05:20:23.451332Z&quot;,</span><br><span class="line">    &quot;build_snapshot&quot; : false,</span><br><span class="line">    &quot;lucene_version&quot; : &quot;7.3.1&quot;,</span><br><span class="line">    &quot;minimum_wire_compatibility_version&quot; : &quot;5.6.0&quot;,</span><br><span class="line">    &quot;minimum_index_compatibility_version&quot; : &quot;5.0.0&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;tagline&quot; : &quot;You Know, for Search&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>이제 kibana 에도 아래 설정을 추가하고 kibana를 실행해서 로그인 화면이 나타나는지 확인합니다.<br><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">xpack.security.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="string">elasticsearch.username:</span> <span class="string">"kibana"</span></span><br><span class="line"><span class="string">elasticsearch.password:</span> <span class="string">"changeme"</span></span><br></pre></td></tr></table></figure></p>
<p><img src="kibana-login.png" alt=""></p>
<p>슈퍼유저 계정인 elastic / changeme 를 넣고 로그인 합니다. Management 메뉴에 가 보면 Security 메뉴도 생성된 것을 볼 수 있습니다.</p>
<p><img src="security-menu.png" alt=""></p>
<p>아직까지는 라이센스를 업로드 하려고 하면 여전히 TLS 설정이 안 되었기 때문에 업로드가 불가능합니다. 예전에 <a href="/2018/01/2018-01-build-es-cluster-6">X-Pack Security를 이용한 SSL 및 TLS 설정</a> 포스트에서 한번 설명은 했는데 6.3에서 인증파일 생성 프로그램 경로가 바뀌어서 다시 한번 설명 하고 넘어가겠습니다.</p>
<p>이미 회사 서버에 사용중인 인증키가 있다면 그대로 사용이 가능합니다. 아직 없다면 인증키를 만들 수 있는 프로그램이 elasticsearch/bin 디렉토리 아래에 있습니다. <code>bin/elasticsearch-certgen</code> 파일입니다. elasticsearch 설치 디렉토리에서 이 프로그램을 실행합니다.<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[]$ bin/elasticsearch-certgen</span><br><span class="line">...</span><br><span class="line">Let&apos;s get started...</span><br><span class="line"></span><br><span class="line">Please enter the desired output file [certificate-bundle.zip]:</span><br><span class="line">Enter instance name: es-cluster</span><br><span class="line">Enter name for directories and files [es-cluster]:</span><br><span class="line">Enter IP Addresses for instance (comma-separated if more than one) []: 179.34.27.193,179.34.16.96,179.34.22.211</span><br><span class="line">Enter DNS names for instance (comma-separated if more than one) []: es-node1,es-node2,es-node3</span><br><span class="line">Would you like to specify another instance? Press &apos;y&apos; to continue entering instance information: n</span><br><span class="line">Certificates written to /home/elastic/elasticsearch-6.3.2/certificate-bundle.zip</span><br></pre></td></tr></table></figure></p>
<ul>
<li>먼저 저장할 파일 이름을 물어보는데 (enter the desired output file) 그냥 엔터를 치면 <code>certificate-bundle.zip</code> 으로 저장됩니다.</li>
<li>다음으로 인스턴스명을 물어봅니다. 저는 <code>es-cluster</code>라고 했습니다.</li>
<li>다음으로 디렉토리를 물어보는데 그냥 엔터를 치면 인스턴스명과 동일하게 하고 넘어갑니다.</li>
<li>다음은 노드들이 있는 서버의 IP 주소들을 쉼표(,)로 구분해서 적어줍니다. <code>179.34.27.193</code>,<code>179.34.16.96</code>,<code>179.34.22.211</code> 3개를 적었습니다.</li>
<li>다음은 마찬가지로 노드들이 있는 서버의 호스트명을 쉼표(,)로 구분해서 적어줍니다. <code>es-node1</code>,<code>es-node2</code>,<code>es-node3</code> 를 적었습니다.</li>
<li>인증키를 추가로 안 만들꺼면 n 을 눌러 종료합니다.</li>
</ul>
<p>종료하고 나면 bin/elasticsearch-certgen 명령을 실행한 디렉토리에 certificate-bundle.zip 있을겁니다. 저는 이것을 elastic 계정 홈 디렉토리 아래에 cert 라는 디렉토리를 만들고 그 아래에 압축을 풀었습니다.<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[~]$ cd</span><br><span class="line">[~]$ mkdir cert</span><br><span class="line">[~]$ cd cert/</span><br><span class="line">[cert]$ mv ../elasticsearch-6.3.2/certificate-bundle.zip ./</span><br><span class="line">[cert]$ unzip certificate-bundle.zip</span><br><span class="line">Archive:  certificate-bundle.zip</span><br><span class="line">   creating: ca/</span><br><span class="line">  inflating: ca/ca.crt</span><br><span class="line">  inflating: ca/ca.key</span><br><span class="line">   creating: es-cluster/</span><br><span class="line">  inflating: es-cluster/es-cluster.crt</span><br><span class="line">  inflating: es-cluster/es-cluster.key</span><br></pre></td></tr></table></figure></p>
<p>cert 디렉토리 아래에 <code>ca</code>, <code>es-cluster</code> 디렉토리가 생기고 그 아래 <em>.crt, </em>.key 파일들이 생성됩니다.</p>
<p>이제 elasticsearch.yml 에 아래 설정을 추가하고 노드들을 재시작합니다.</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">xpack.ssl.key:</span> <span class="string">/home/elastic/cert/es-cluster/es-cluster.key</span></span><br><span class="line"><span class="string">xpack.ssl.certificate:</span> <span class="string">/home/elastic/cert/es-cluster/es-cluster.crt</span></span><br><span class="line"><span class="string">xpack.ssl.certificate_authorities:</span> <span class="string">[</span> <span class="string">"/home/elastic/cert/ca/ca.crt"</span> <span class="string">]</span></span><br><span class="line"><span class="string">xpack.security.transport.ssl.enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>당연히 위 파일들은 모든 서버들의 동일한 경로에 복사되어 있어야 합니다. 가능하면 이런 파일들은 NFS 같은 네트워크 디렉토리를 사용하는 것이 좋습니다. 노드를 재시작 하면 이제 TLS가 활성화 되어 노드들끼리 9300번 포트에서 하는 TCP 통신은 모두 암호화되어 전송됩니다.</p>
<p>이제 Management &gt; License Management 메뉴에 가서 가지고 있는 라이센스 키를 업로드 하면 정상적으로 사용 기간이 라이센스 기간 만큼 늘어나게 됩니다.</p>
<p><img src="platinum-enabled.png" alt=""></p>


                <hr>

                

                <ul class="pager">
                    
                    
                        <li class="next">
                            <a href="/2018/07/2018-07-elastic-certified-engineer/" data-toggle="tooltip" data-placement="top" title="Elastic Certified Engineer 자격 시험">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                

                
                <!-- disqus 评论框 start -->
                <div class="comment">
                    <div id="disqus_thread" class="disqus-thread"></div>
                </div>
                <!-- disqus 评论框 end -->
                

            </div>
    <!-- Side Catalog Container -->
        

    <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#Elasticsearch" title="Elasticsearch">Elasticsearch</a>
                        
                          <a class="tag" href="/tags/#Elastic" title="Elastic">Elastic</a>
                        
                          <a class="tag" href="/tags/#Elastic Cluster Settings" title="Elastic Cluster Settings">Elastic Cluster Settings</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="https://elastic.co">Elastic</a></li>
                    
                        <li><a href="http://david.pilato.fr">David Pilato Blog</a></li>
                    
                </ul>
                
            </div>

        </div>
    </div>
</article>




<!-- disqus 公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = "kimjmin";
    var disqus_identifier = "http://kimjmin.net/2018/08/2018-08-install-security-over-es63/";
    var disqus_url = "http://kimjmin.net/2018/08/2018-08-install-security-over-es63/";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- disqus 公共JS代码 end -->




<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("http://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                  <!-- Jongmin Kim : RSS Feed added start -->
                  <li>
                      <a href="/atom.xml">
                          <span class="fa-stack fa-lg">
                              <i class="fa fa-circle fa-stack-2x"></i>
                              <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                          </span>
                      </a>
                  </li>
                  <!-- Jongmin Kim : RSS Feed added end -->
                
                
                    <li>
                        <a target="_blank" href="https://twitter.com/kimjmin">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                
                

                

                
                    <li>
                        <a target="_blank" href="https://www.facebook.com/kimjmin81">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank"  href="https://github.com/kimjmin">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank"  href="https://www.linkedin.com/in/kimjmin">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Jongmin&#39;s Blog 2018 
                    <br>
                    Theme by <a href="http://huangxuan.me">Hux</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    Ported by <a href="http://blog.kaijun.rocks">Kaijun</a> | 
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=kaijun&repo=hexo-theme-huxblog&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("http://kimjmin.net/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("http://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-51709817-2';
    var _gaDomain = 'kimjmin.net';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->


<!-- Side Catalog -->





<!-- Image to hack wechat -->
<img src="http://kimjmin.net/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
